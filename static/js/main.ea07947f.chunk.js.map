{"version":3,"sources":["custom-markmap.ts","export.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["maxVisibleBranchDepth","child","depth","d","p","f","c","length","childValues","flatMap","Math","max","modifyChildVisibility","node","modifyNode","forEach","CustomMarkmap","this","state","data","depthCutoff","maxLevel","renderData","Markmap","downloadString","dataURL","filename","element","document","createElement","setAttribute","body","appendChild","click","removeChild","exportClickSVG","svgFileText","backgroundColour","svgTextWithAttribute","querySelector","outerHTML","replace","replaceAll","getSafeSVG","btoa","convertAndDownload","conversionFn","transparent","a","mindmapContainer","mindmapWrapper","backgroundColor","bgcolor","scale","exportClickPNG","domtoimage","toPng","toSvg","transformer","Transformer","Control","children","onClick","title","className","Controls","markMapRef","onZoom","svgElementRef","multiplier","current","rescale","onCollapse","collapseTree","fit","onExpand","expandTree","Mindmap","value","useEffect","colorFn","duration","color","d3","toString","nodeMinHeight","spacingVertical","spacingHorizontal","paddingX","nodeFont","markMap","root","transform","setData","ref","Sidebar","onChange","textAreaRef","useRef","open","onToggle","e","target","focus","App","valueFromParams","URLSearchParams","location","search","get","decodedValueFromParams","atob","useState","setValue","newValue","searchParams","set","newRelativePathQuery","window","pathname","history","pushState","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ea07947f.chunk.js","sourcesContent":["\nimport { Markmap } from 'markmap-view';\nimport { INode } from 'markmap-common';\n\n// The circle between columns counts as one\n// so we must remove two\nconst ONE_MARKMAP_LEVEL = 2;\n\nfunction maxVisibleBranchDepth(child: INode): number {\n    const depth = child.d || -1;\n    const hiddenChildren = child?.p?.f === true;\n\n    if (!hiddenChildren && child?.c?.length) {\n        const childValues = child.c.flatMap(maxVisibleBranchDepth)\n        return Math.max(...childValues);\n    }\n\n    return depth;\n}\n\nconst markChildrenAsHidden = (depthCutoff: number) => (child: INode) => {\n    if (child.d && child.d >= depthCutoff) {\n        child.p.f = true;\n    }\n};\n\nconst markChildrenAsVisible = (depthCutoff: number) => (child: INode) => {\n    if (child?.d === depthCutoff) {\n        child.p.f = false;\n    }\n};\n\nfunction modifyChildVisibility(node: INode, modifyNode: Function): void {\n    modifyNode(node);\n\n    node.c?.forEach(child => {\n        modifyChildVisibility(child, modifyNode);\n    })\n}\n\nexport class CustomMarkmap extends Markmap {\n    collapseTree() {\n        if (!this.state.data) return;\n\n        const maxLevel = maxVisibleBranchDepth(this.state.data);\n        const modifyNode = markChildrenAsHidden(maxLevel - ONE_MARKMAP_LEVEL);\n        modifyChildVisibility(this.state.data, modifyNode);\n\n        this.renderData();\n    }\n    expandTree() {\n        if (!this.state.data) return;\n\n        const maxLevel = maxVisibleBranchDepth(this.state.data);\n        const modifyNode = markChildrenAsVisible(maxLevel);\n        modifyChildVisibility(this.state.data, modifyNode);\n\n        this.renderData();\n    }\n}\n","import domtoimage, { ConvertFunction } from \"dom-to-image-more\";\n\nconst downloadString = (dataURL: string, filename: string) => {\n    const element = document.createElement('a');\n    element.setAttribute('href', dataURL);\n    element.setAttribute('download', filename);\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n};\n\nconst getSafeSVG = (backgroundColour?: string) => {\n    // TODO: Need to somehow zoom in before capturing - should this be done in an invisible copy?\n    const svgText = document.querySelector('.mindmap')?.outerHTML || \"\";\n    const svgTextWithAttribute = svgText\n        .replace('<svg ', '<svg xmlns=\"http://www.w3.org/2000/svg\" ')\n        .replaceAll('<br>', '<br></br>');\n\n    const svgFileText = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>${svgTextWithAttribute}`;\n\n    return svgFileText;\n}\n\nexport const exportClickSVG = () => {\n    const svgFileText = getSafeSVG();\n    const dataURL = `data:image/svg;base64,${btoa(svgFileText)}`;\n\n    downloadString(dataURL, 'mindmap.svg');\n};\n\nconst convertAndDownload = (conversionFn: ConvertFunction, filename: string) => (transparent: boolean = false) => async () => {\n    const mindmapContainer = document.querySelector('.mindmap-wrapper');\n    if (!mindmapContainer) return;\n\n    const mindmapWrapper = mindmapContainer;\n    const backgroundColor = transparent ? 'transparent' : 'white';\n    const dataURL = await conversionFn(\n        mindmapWrapper,\n        { bgcolor: backgroundColor, scale: 2 }\n    );\n    downloadString(dataURL, filename);\n}\n\nexport const exportClickPNG = convertAndDownload(domtoimage.toPng, 'mindmap.png');\n// Below is very slow, but has accurate text rendering - maybe make optional?\nexport const exportClickSVGSlow = convertAndDownload(domtoimage.toSvg, 'mindmap.svg');\n","import React, { useState, useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport { INode } from 'markmap-common';\nimport { Transformer } from 'markmap-lib';\nimport { CustomMarkmap } from './custom-markmap';\nimport { exportClickPNG, exportClickSVG } from './export';\n\nimport './App.css';\n\nconst transformer = new Transformer();\nconst initValue = `# Title\n\n- one\n- two\n- third item\n  - fourth item\n    second line\n  - five\n    - six\n\n`;\n\nfunction Control({ children, onClick, title }: { children: React.ReactChild | React.ReactChild[], onClick: any, title?: string }) {\n  return <button title={title} onClick={onClick} className=\"controls__button\">{children}</button>\n}\n\nfunction Controls({ markMapRef, svgElementRef }: { markMapRef: React.MutableRefObject<CustomMarkmap | null>, svgElementRef: React.MutableRefObject<SVGSVGElement | null> }) {\n\n  const onZoom = (multiplier: number) => () => {\n    if (markMapRef.current) {\n      markMapRef.current.rescale(1 * multiplier)\n    }\n  }\n\n  const onCollapse = async () => {\n    if (markMapRef.current) {\n      markMapRef.current.collapseTree();\n      await markMapRef.current.fit();\n    }\n  }\n  const onExpand = async () => {\n    if (markMapRef.current) {\n      markMapRef.current.expandTree();\n      await markMapRef.current.fit();\n    }\n  }\n\n  return <ul className=\"controls\">\n    <li><Control title=\"Zoom in\" onClick={onZoom(1.2)}>+</Control></li>\n    <li><Control title=\"Zoom out\" onClick={onZoom(0.8)}>-</Control></li>\n    <li><Control title=\"Collapse nodes\" onClick={onCollapse}>&#60;</Control></li>\n    <li><Control title=\"Expand nodes\" onClick={onExpand}>&#62;</Control></li>\n    <li><Control onClick={exportClickSVG}>Export SVG</Control></li>\n    <li><Control onClick={exportClickPNG()}>Export PNG</Control></li>\n  </ul>\n}\n\nfunction Mindmap({ value, markMapRef, svgElementRef }: { value: string, markMapRef: React.MutableRefObject<CustomMarkmap | null>, svgElementRef: React.MutableRefObject<SVGSVGElement | null> }) {\n  useEffect(() => {\n    if (markMapRef.current) return;\n    if (!svgElementRef.current) return;\n\n    markMapRef.current = new CustomMarkmap(svgElementRef.current, {\n      duration: 0,\n      color: (\n        (colorFn) =>\n          (node: INode): string =>\n            colorFn(node.d!.toString())\n      )(d3.scaleOrdinal([\"#4c28cf\", \"#0e52ec\", \"#ea13b1\", \"#2ec9c2\", \"#0fd991\", \"#d90f32\", \"#f2c317\", \"#377eb8\", \"#4daf4a\", \"#984ea3\", \"#ff7f00\", \"#ffff33\", \"#a65628\", \"#f781bf\", \"#999999\"])),\n      nodeMinHeight: 20,\n      spacingVertical: 8,\n      spacingHorizontal: 24,\n      paddingX: 8,\n      nodeFont: `400 10px/12px -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif`\n    });\n  }, [markMapRef, svgElementRef]);\n\n  useEffect(() => {\n    const markMap = markMapRef.current;\n    if (markMap) {\n      const { root } = transformer.transform(value);\n      markMap.setData(root);\n      markMap.fit();\n    }\n\n  }, [markMapRef, value]);\n\n  return (\n    <div className='mindmap-wrapper'>\n      <svg className=\"mindmap\" ref={svgElementRef} />\n    </div>\n  );\n}\n\nfunction Sidebar({ value, onChange }: { value: string, onChange: any }) {\n  const textAreaRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleChange = (e: any) => {\n    onChange(e.target.value);\n  };\n\n  const handleToggle = (e: any) => {\n    if (e.target.open && textAreaRef.current) {\n      textAreaRef.current.focus();\n    }\n  };\n\n  return (\n    <details className=\"sidebar\" open onToggle={handleToggle}>\n      <textarea\n        ref={textAreaRef}\n        className=\"\"\n        value={value}\n        onChange={handleChange}\n      />\n\n      <summary><b className=\"summary-text\">&#10095;</b></summary>\n    </details>\n  )\n}\n\nfunction App() {\n  const valueFromParams = new URLSearchParams(document.location.search).get('input');\n  const decodedValueFromParams = valueFromParams && atob(valueFromParams);\n  const [value, setValue] = useState(decodedValueFromParams || initValue);\n\n\n  const markMapRef = useRef<CustomMarkmap | null>(null);\n  const svgElementRef = useRef<SVGSVGElement | null>(null);\n\n  const updateWithNewValue = (newValue: string) => {\n    const searchParams = new URLSearchParams(document.location.search);\n    searchParams.set(\"input\", btoa(newValue));\n    var newRelativePathQuery = window.location.pathname + '?' + searchParams.toString();\n    window.history.pushState(null, '', newRelativePathQuery);\n    setValue(newValue);\n  }\n\n  return (<>\n    <Sidebar value={value} onChange={updateWithNewValue} />\n    <Mindmap value={value} markMapRef={markMapRef} svgElementRef={svgElementRef} />\n    <Controls markMapRef={markMapRef} svgElementRef={svgElementRef} />\n  </>)\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}